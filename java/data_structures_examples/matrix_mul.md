### **–ü–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∑–∞–¥–∞—á–∏ "1931. Painting a Grid With Three Different Colors"**

**–ó–∞–¥–∞—á–∞:**  
–î–∞–Ω–∞ —Å–µ—Ç–∫–∞ `m x n`. –ù—É–∂–Ω–æ —Ä–∞—Å–∫—Ä–∞—Å–∏—Ç—å –∫–∞–∂–¥—É—é –∫–ª–µ—Ç–∫—É –≤ –æ–¥–∏–Ω –∏–∑ 3 —Ü–≤–µ—Ç–æ–≤ (R, G, B) —Ç–∞–∫, —á—Ç–æ–±—ã **–Ω–∏–∫–∞–∫–∏–µ –¥–≤–µ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏** (–ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏) –Ω–µ –±—ã–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞. –í–µ—Ä–Ω—É—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø–æ –º–æ–¥—É–ª—é `10^9 + 7`.

---

## **1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä–æ–∫**
–î–ª—è —Å—Ç—Ä–æ–∫–∏ –∏–∑ `m` –∫–ª–µ—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å–∫—Ä–∞—Å–∫–∏, –≥–¥–µ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏ —Ä–∞–∑–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞.

```python
def generate_rows():
    from itertools import product
    colors = ['R', 'G', 'B']
    rows = []
    for p in product(colors, repeat=m):  # –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ü–≤–µ—Ç–æ–≤
        valid = True
        for i in range(m - 1):
            if p[i] == p[i + 1]:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
                valid = False
                break
        if valid:
            rows.append(p)  # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ —Ä–∞—Å–∫—Ä–∞—Å–∫–∏
    return rows
```
**–ü—Ä–∏–º–µ—Ä –¥–ª—è `m=2`:**  
–î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ä–∞—Å–∫—Ä–∞—Å–∫–∏: `['RG', 'RB', 'GR', 'GB', 'BR', 'BG']` (6 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤).

---

## **2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤**
–ú–∞—Ç—Ä–∏—Ü–∞ `A` —Ä–∞–∑–º–µ—Ä–∞ `K x K` (–≥–¥–µ `K` ‚Äî —á–∏—Å–ª–æ –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä–æ–∫).  
`A[i][j] = 1`, –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫—É `j` –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å **–ø–æ–¥** —Å—Ç—Ä–æ–∫—É `i` (—Ç.–µ. —Ü–≤–µ—Ç–∞ –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö —Ä–∞–∑–Ω—ã–µ).

```python
K = len(rows)
A = [[0] * K for _ in range(K)]  # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω—É–ª–µ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É

for i in range(K):
    for j in range(K):
        valid = True
        for k in range(m):  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã
            if rows[i][k] == rows[j][k]:  # –ï—Å–ª–∏ —Ü–≤–µ—Ç–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
                valid = False
                break
        if valid:
            A[i][j] = 1
```
**–ü—Ä–∏–º–µ—Ä –¥–ª—è `m=2`:**  
–ï—Å–ª–∏ `rows[i] = "RG"`, —Ç–æ `rows[j]` –º–æ–∂–µ—Ç –±—ã—Ç—å `"GB"`, `"BR"`, –Ω–æ –Ω–µ `"GR"` (—Ç.–∫. `G` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –≤–æ –≤—Ç–æ—Ä–æ–º —Å—Ç–æ–ª–±—Ü–µ).

---

## **3. –ë—ã—Å—Ç—Ä–æ–µ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –≤ —Å—Ç–µ–ø–µ–Ω—å**
–ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ **–±–∏–Ω–∞—Ä–Ω–æ–≥–æ –≤–æ–∑–≤–µ–¥–µ–Ω–∏—è –≤ —Å—Ç–µ–ø–µ–Ω—å**, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–∏—Ç—å `A^(n-1)` –∑–∞ `O(log n)` –æ–ø–µ—Ä–∞—Ü–∏–π.

```python
def matrix_pow(mat, power):
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ–¥–∏–Ω–∏—á–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É (–∞–Ω–∞–ª–æ–≥ 1 –¥–ª—è —É–º–Ω–æ–∂–µ–Ω–∏—è)
    result = [[1 if i == j else 0 for j in range(K)] for i in range(K)]
    
    while power > 0:
        if power % 2 == 1:  # –ï—Å–ª–∏ —Å—Ç–µ–ø–µ–Ω—å –Ω–µ—á—ë—Ç–Ω–∞—è
            result = matrix_mult(result, mat)  # –£–º–Ω–æ–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ mat
        mat = matrix_mult(mat, mat)  # –í–æ–∑–≤–æ–¥–∏–º mat –≤ –∫–≤–∞–¥—Ä–∞—Ç
        power //= 2  # –£–º–µ–Ω—å—à–∞–µ–º —Å—Ç–µ–ø–µ–Ω—å –≤–¥–≤–æ–µ
    return result

def matrix_mult(a, b):
    res = [[0] * K for _ in range(K)]
    for i in range(K):
        for k in range(K):
            if a[i][k]:  # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —É–º–Ω–æ–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–Ω—É–ª–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                for j in range(K):
                    res[i][j] = (res[i][j] + a[i][k] * b[k][j]) % MOD
    return res
```
**–ü–æ—á–µ–º—É –µ–¥–∏–Ω–∏—á–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞?**  
–ü–æ—Ç–æ–º—É —á—Ç–æ `A^0 = E` (–∫–∞–∫ `x^0 = 1` –¥–ª—è —á–∏—Å–µ–ª).

---

## **4. –ü–æ–¥—Å—á—ë—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ø–æ—Å–æ–±–æ–≤**
–ü–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è `A^(n-1)` —Å—É–º–º–∏—Ä—É–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç.

```python
mat = matrix_pow(A, n - 1)  # –í–æ–∑–≤–æ–¥–∏–º –º–∞—Ç—Ä–∏—Ü—É –≤ —Å—Ç–µ–ø–µ–Ω—å (n-1)
total = 0
for i in range(K):
    for j in range(K):
        total = (total + mat[i][j]) % MOD  # –°—É–º–º–∏—Ä—É–µ–º –≤—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
return total
```
**–ü–æ—è—Å–Ω–µ–Ω–∏–µ:**  
–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç `mat[i][j]` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏ `i` –≤ —Å—Ç—Ä–æ–∫—É `j` –∑–∞ `(n-1)` —à–∞–≥–æ–≤.

---

## **5. –ü—Ä–∏–º–µ—Ä –¥–ª—è `m=2, n=2`**
1. **–í–∞–ª–∏–¥–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:** `['RG', 'RB', 'GR', 'GB', 'BR', 'BG']` (6 —à—Ç.).
2. **–ú–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ `A`:**  
   - –ù–∞–ø—Ä–∏–º–µ—Ä, `A["RG"]["GB"] = 1` (–º–æ–∂–Ω–æ),  
   - `A["RG"]["GR"] = 0` (–Ω–µ–ª—å–∑—è, —Ç.–∫. `G` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –≤–æ –≤—Ç–æ—Ä–æ–º —Å—Ç–æ–ª–±—Ü–µ).
3. **`A^(2-1) = A`:**  
   –°—É–º–º–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ = 24 (—á—Ç–æ –≤–µ—Ä–Ω–æ: 6 —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ √ó 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–∏).

---

## **6. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
- **–î–ª—è `m=5`** –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –≤—Å–µ–≥–æ 48 (–∞ –Ω–µ `3^5 = 243`), –ø–æ—ç—Ç–æ–º—É –º–∞—Ç—Ä–∏—Ü–∞ 48√ó48 ‚Äî –Ω–µ–±–æ–ª—å—à–∞—è.
- **–ë—ã—Å—Ç—Ä–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ** –º–∞—Ç—Ä–∏—Ü –∑–∞ `O(K^3)`.
- **–ë–∏–Ω–∞—Ä–Ω–æ–µ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å** –∑–∞ `O(log n)`.

---

## **–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–¥**
```python
MOD = 10**9 + 7

class Solution:
    def colorTheGrid(self, m: int, n: int) -> int:
        # 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Ç—Ä–æ–∫
        def generate_rows():
            from itertools import product
            colors = ['R', 'G', 'B']
            rows = []
            for p in product(colors, repeat=m):
                valid = True
                for i in range(m - 1):
                    if p[i] == p[i + 1]:
                        valid = False
                        break
                if valid:
                    rows.append(p)
            return rows

        rows = generate_rows()
        K = len(rows)
        if K == 0:
            return 0

        # 2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
        A = [[0] * K for _ in range(K)]
        for i in range(K):
            for j in range(K):
                valid = True
                for k in range(m):
                    if rows[i][k] == rows[j][k]:
                        valid = False
                        break
                if valid:
                    A[i][j] = 1

        # 3. –ë—ã—Å—Ç—Ä–æ–µ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å
        def matrix_mult(a, b):
            res = [[0] * K for _ in range(K)]
            for i in range(K):
                for k in range(K):
                    if a[i][k]:
                        for j in range(K):
                            res[i][j] = (res[i][j] + a[i][k] * b[k][j]) % MOD
            return res

        def matrix_pow(mat, power):
            result = [[1 if i == j else 0 for j in range(K)] for i in range(K)]
            while power > 0:
                if power % 2 == 1:
                    result = matrix_mult(result, mat)
                mat = matrix_mult(mat, mat)
                power //= 2
            return result

        mat = matrix_pow(A, n - 1)
        total = 0
        for i in range(K):
            for j in range(K):
                total = (total + mat[i][j]) % MOD
        return total
```

---

## **–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã**
1. **–ì—Ä–∞—Ñ–æ–≤–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**  
   - –í–µ—Ä—à–∏–Ω—ã ‚Äî –≤–∞–ª–∏–¥–Ω—ã–µ —Ä–∞—Å–∫—Ä–∞—Å–∫–∏ —Å—Ç—Ä–æ–∫.  
   - –†—ë–±—Ä–∞ ‚Äî —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏.  
2. **–ú–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤** ‚Äî —ç—Ç–æ –º–∞—Ç—Ä–∏—Ü–∞ —Å–º–µ–∂–Ω–æ—Å—Ç–∏ –≥—Ä–∞—Ñ–∞.  
3. **–û—Ç–≤–µ—Ç** ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö –ø—É—Ç–µ–π –¥–ª–∏–Ω—ã `(n-1)` –≤ –≥—Ä–∞—Ñ–µ.  

–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞–∑–±–æ—Ä –∏ –∫–æ–¥ –∫–∞–∫ —à–ø–∞—Ä–≥–∞–ª–∫—É! üòé